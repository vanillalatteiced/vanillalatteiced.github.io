<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"><link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"><style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li:not(:nth-child(2)) > a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(2) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; }</style><script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><title>SSH Certificates | Itty Bitty</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="SSH Certificates" /><meta property="og:locale" content="en_US" /><meta name="description" content="Online long-term memory of a novice programmer" /><meta property="og:description" content="Online long-term memory of a novice programmer" /><meta property="og:site_name" content="Itty Bitty" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SSH Certificates" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Online long-term memory of a novice programmer","headline":"SSH Certificates","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/logo/ittybitty.png"}},"url":"/docs/security/ssh/cert.html"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"><div class="site-logo" role="img" aria-label="Itty Bitty"></div></a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Demo category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/demo/" class="nav-list-link">Demo</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Others category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/others/" class="nav-list-link">Others</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Chrome Extensions category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/others/chrome-ext/" class="nav-list-link">Chrome Extensions</a><ul class="nav-list"></ul><li class="nav-list-item"><a href="/docs/others/dbeaver/" class="nav-list-link">DBeaver</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Homebrew category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/others/homebrew/" class="nav-list-link">Homebrew</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/others/homebrew/x86.html" class="nav-list-link">Homebrew x86_64</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in IntelliJ category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/others/intellij/" class="nav-list-link">IntelliJ</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/others/intellij/cli.html" class="nav-list-link">CLI Setup</a></ul><li class="nav-list-item"><a href="/docs/others/jekyll/" class="nav-list-link">Jekyll</a><li class="nav-list-item"><a href="/docs/others/mongodb/" class="nav-list-link">MongoDB</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Scrapy category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/others/scrapy/" class="nav-list-link">Scrapy</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in VSCode category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/others/vscode/" class="nav-list-link">VSCode</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/others/vscode/debugger.html" class="nav-list-link">VSCode Debugger</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Vim category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/others/vim/" class="nav-list-link">Vim</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/others/vim/ide.html" class="nav-list-link">As IDE Extensions</a><li class="nav-list-item"> <a href="/docs/others/vim/vim-plug.html" class="nav-list-link">vim-plug</a></ul><li class="nav-list-item"><a href="/docs/others/volta/" class="nav-list-link">Volta</a><li class="nav-list-item"><a href="/docs/others/ngrok/" class="nav-list-link">ngrok</a><li class="nav-list-item"><a href="/docs/others/zsh/" class="nav-list-link">zsh</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in AWS category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/aws/" class="nav-list-link">AWS</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/aws/aws-cli.html" class="nav-list-link">AWS CLI</a><li class="nav-list-item"><a href="/docs/aws/chalice.html" class="nav-list-link">Chalice</a><li class="nav-list-item"><a href="/docs/aws/cognito.html" class="nav-list-link">Cognito</a><li class="nav-list-item"><a href="/docs/aws/dynamodb.html" class="nav-list-link">DynamoDB</a><li class="nav-list-item"><a href="/docs/aws/ecr.html" class="nav-list-link">ECR</a><li class="nav-list-item"><a href="/docs/aws/beanstalk.html" class="nav-list-link">Elastic Beanstalk</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Computer Science category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/compsci/" class="nav-list-link">Computer Science</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Algorithms category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/compsci/algo/" class="nav-list-link">Algorithms</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Computing category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/compsci/computing/" class="nav-list-link">Computing</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Math/Concepts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/compsci/math/" class="nav-list-link">Math/Concepts</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in ADT/Data Structures category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/compsci/data-structures/" class="nav-list-link">ADT/Data Structures</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in LeetCode category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/compsci/leetcode/" class="nav-list-link">LeetCode</a><ul class="nav-list"></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Data Science category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/data-science/" class="nav-list-link">Data Science</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in DS Quick Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/data-science/notes/" class="nav-list-link">DS Quick Notes</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in ML/DL category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/data-science/ml-dl/" class="nav-list-link">ML/DL</a><ul class="nav-list"></ul><li class="nav-list-item"><a href="/docs/data-science/m1-tf.html" class="nav-list-link">M1 TensorFlow</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Time Series Analysis category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/data-science/time-series/" class="nav-list-link">Time Series Analysis</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/data-science/time-series/intro-to-time-series.html" class="nav-list-link">What is Time Series Analysis?</a><li class="nav-list-item"> <a href="/docs/data-science/time-series/time-series-data.html" class="nav-list-link">Exploring Time Series Data</a><li class="nav-list-item"> <a href="/docs/data-science/time-series/basic-preprocessing.html" class="nav-list-link">Basic Preprocessing</a><li class="nav-list-item"> <a href="/docs/data-science/time-series/statistical-model.html" class="nav-list-link">Statistical Model for Time Series</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Database category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/db/" class="nav-list-link">Database</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in DB Quick Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/db/notes/" class="nav-list-link">DB Quick Notes</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Database Systems category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/db/db-systems/" class="nav-list-link">Database Systems</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in MySQL/MariaDB category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/db/mysql/" class="nav-list-link">MySQL/MariaDB</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/db/mysql/client.html" class="nav-list-link">MySQL Client</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in SQL category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/db/sql/" class="nav-list-link">SQL</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/db/sql/query-basics.html" class="nav-list-link">SQL Query Basics</a><li class="nav-list-item"> <a href="/docs/db/sql/joins.html" class="nav-list-link">SQL Joins</a><li class="nav-list-item"> <a href="/docs/db/sql/grouping.html" class="nav-list-link">SQL Grouping</a><li class="nav-list-item"> <a href="/docs/db/sql/cte.html" class="nav-list-link">SQL CTE</a><li class="nav-list-item"> <a href="/docs/db/sql/window-function.html" class="nav-list-link">SQL Window Function</a><li class="nav-list-item"> <a href="/docs/db/sql/more-aggregation.html" class="nav-list-link">SQL Advanced Aggregation</a><li class="nav-list-item"> <a href="/docs/db/sql/ddl.html" class="nav-list-link">DDL</a><li class="nav-list-item"> <a href="/docs/db/sql/hierarchical-query.html" class="nav-list-link">Hierarchical Query</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Docker category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/docker/" class="nav-list-link">Docker</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/docker/compose.html" class="nav-list-link">Docker Compose</a><li class="nav-list-item"><a href="/docs/docker/container.html" class="nav-list-link">Docker Container</a><li class="nav-list-item"><a href="/docs/docker/images.html" class="nav-list-link">Docker Images</a><li class="nav-list-item"><a href="/docs/docker/networks.html" class="nav-list-link">Docker Networks</a><li class="nav-list-item"><a href="/docs/docker/volumes.html" class="nav-list-link">Docker Volumes</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Flask category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/flask/" class="nav-list-link">Flask</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Flutter category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/flutter/" class="nav-list-link">Flutter</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/flutter/setup.html" class="nav-list-link">Flutter Setup</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Git/GitHub category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/git-hub/" class="nav-list-link">Git/GitHub</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Git category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/git-hub/git/" class="nav-list-link">Git</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/git-hub/git/sparse.html" class="nav-list-link">Sparse Checkout</a><li class="nav-list-item"> <a href="/docs/git-hub/git/useful.html" class="nav-list-link">Useful Git Commands</a><li class="nav-list-item"> <a href="/docs/git-hub/git/filter-repo.html" class="nav-list-link">filter-repo</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in GitHub category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/git-hub/github/" class="nav-list-link">GitHub</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/git-hub/github/actions.html" class="nav-list-link">GitHub Actions</a><li class="nav-list-item"> <a href="/docs/git-hub/github/useful.html" class="nav-list-link">Useful Notes</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Java category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/java/" class="nav-list-link">Java</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/java/jmap.html" class="nav-list-link">Java Memory</a><li class="nav-list-item"><a href="/docs/java/jenv.html" class="nav-list-link">jenv</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Jenkins category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/jenkins/" class="nav-list-link">Jenkins</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/jenkins/docker.html" class="nav-list-link">Dockerized Jenkins</a><li class="nav-list-item"><a href="/docs/jenkins/github.html" class="nav-list-link">GitHub Integration</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Kubernetes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/kubernetes/" class="nav-list-link">Kubernetes</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/kubernetes/basics.html" class="nav-list-link">Basics</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Linear Algebra category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/linalg/" class="nav-list-link">Linear Algebra</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Linear Algebra Quick Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/linalg/notes/" class="nav-list-link">Linear Algebra Quick Notes</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Linear Algebra Basics category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/linalg/basics/" class="nav-list-link">Linear Algebra Basics</a><ul class="nav-list"></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Linux category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/linux/" class="nav-list-link">Linux</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/linux/init.html" class="nav-list-link">Basic Linux Setup</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Python category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/python/" class="nav-list-link">Python</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Python Environments category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/python/envs/" class="nav-list-link">Python Environments</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/python/envs/conda.html" class="nav-list-link">Conda</a><li class="nav-list-item"> <a href="/docs/python/envs/pipenv.html" class="nav-list-link">Pipenv</a><li class="nav-list-item"> <a href="/docs/python/envs/poetry.html" class="nav-list-link">Poetry</a><li class="nav-list-item"> <a href="/docs/python/envs/pyenv.html" class="nav-list-link">pyenv</a><li class="nav-list-item"> <a href="/docs/python/envs/venv.html" class="nav-list-link">venv</a></ul><li class="nav-list-item"><a href="/docs/python/package.html" class="nav-list-link">Python Package</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Security category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/security/" class="nav-list-link">Security</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/security/pgp/" class="nav-list-link">PGP Key</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in SSH category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/security/ssh/" class="nav-list-link">SSH</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/security/ssh/basics.html" class="nav-list-link">SSH Basics</a><li class="nav-list-item"> <a href="/docs/security/ssh/cert.html" class="nav-list-link">SSH Certificates</a><li class="nav-list-item"> <a href="/docs/security/ssh/config.html" class="nav-list-link">SSH Config</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in SSL category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/security/ssl/" class="nav-list-link">SSL</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/security/ssl/csr.html" class="nav-list-link">CSR</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Vault category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/security/vault/" class="nav-list-link">Vault</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/security/vault/basics.html" class="nav-list-link">Vault Server Basics</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Statistics category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/statistics/" class="nav-list-link">Statistics</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Stats/ML Quick Notes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/statistics/notes/" class="nav-list-link">Stats/ML Quick Notes</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Basic Stats for Data category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/statistics/basics/" class="nav-list-link">Basic Stats for Data</a><ul class="nav-list"><li class="nav-list-item"> <a href="/docs/statistics/basics/basic-probs.html" class="nav-list-link">Basic Probability</a><li class="nav-list-item"> <a href="/docs/statistics/basics/inferencial-stats.html" class="nav-list-link">Inferential Statistics</a><li class="nav-list-item"> <a href="/docs/statistics/basics/hypothesis-testing.html" class="nav-list-link">Hypothesis Testing</a></ul></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Terraform category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/terraform/" class="nav-list-link">Terraform</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/terraform/basics.html" class="nav-list-link">Terraform Basics</a><li class="nav-list-item"><a href="/docs/terraform/config.html" class="nav-list-link">Terraform Configuration</a><li class="nav-list-item"><a href="/docs/terraform/terraform-module.html" class="nav-list-link">Terraform Module</a><li class="nav-list-item"><a href="/docs/terraform/tfenv.html" class="nav-list-link">tfenv</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Things I Learned category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/learned/" class="nav-list-link">Things I Learned</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/learned/db/" class="nav-list-link">Database</a><li class="nav-list-item"><a href="/docs/learned/frontend-web.html" class="nav-list-link">Frontend Web</a><li class="nav-list-item"><a href="/docs/learned/network/" class="nav-list-link">Network</a><li class="nav-list-item"><a href="/docs/learned/oauth2/" class="nav-list-link">OAuth 2.0</a><li class="nav-list-item"><a href="/docs/learned/useful.html" class="nav-list-link">Useful Commands</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Vue category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/vue/" class="nav-list-link">Vue</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/vue/jsts.html" class="nav-list-link">JS/TS Cheatsheet</a><li class="nav-list-item"><a href="/docs/vue/sb.html" class="nav-list-link">Storybook UI</a><li class="nav-list-item"><a href="/docs/vue/init.html" class="nav-list-link">Vue Project Setup</a><li class="nav-list-item"><a href="/docs/vue/quick-notes.html" class="nav-list-link">Vue Quick Notes</a></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Itty Bitty" aria-label="Search Itty Bitty" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/security/">Security</a><li class="breadcrumb-nav-list-item"><a href="/docs/security/ssh/">SSH</a><li class="breadcrumb-nav-list-item"><span>SSH Certificates</span></ol></nav><div id="main-content" class="main-content"><main><h1 class="no_toc" id="ssh-certificates"> <a href="#ssh-certificates" class="anchor-heading" aria-labelledby="ssh-certificates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SSH Certificates</h1><details open=""> <summary class="text-delta"> Table of contents </summary><ol id="markdown-toc"><li><a href="#ssh-authentication-methods" id="markdown-toc-ssh-authentication-methods">SSH authentication methods</a><li><a href="#ssh-certificates-1" id="markdown-toc-ssh-certificates-1">SSH certificates</a><li><a href="#host-certificate" id="markdown-toc-host-certificate">Host certificate</a><ol><li><a href="#configure-a-host-ca" id="markdown-toc-configure-a-host-ca">Configure a host CA</a><li><a href="#sign-the-host-key-with-ca" id="markdown-toc-sign-the-host-key-with-ca">Sign the host key with CA</a><li><a href="#save-host-ca-public-key-on-client" id="markdown-toc-save-host-ca-public-key-on-client">Save host CA public key on client</a></ol><li><a href="#client-certificate" id="markdown-toc-client-certificate">Client certificate</a><ol><li><a href="#configure-a-client-ca" id="markdown-toc-configure-a-client-ca">Configure a client CA</a><li><a href="#sign-the-client-key-with-ca" id="markdown-toc-sign-the-client-key-with-ca">Sign the client key with CA</a><li><a href="#save-client-ca-public-key-on-host" id="markdown-toc-save-client-ca-public-key-on-host">Save client CA public key on host</a></ol><li><a href="#host-sshd_config-settings" id="markdown-toc-host-sshd_config-settings">Host <code class="language-plaintext highlighter-rouge">sshd_config</code> settings</a><li><a href="#test-connection" id="markdown-toc-test-connection">Test connection</a><li><a href="#debugging" id="markdown-toc-debugging">Debugging</a><ol><li><a href="#from-the-client-side" id="markdown-toc-from-the-client-side">From the client side</a><li><a href="#from-the-host-side" id="markdown-toc-from-the-host-side">From the host side</a><ol><li><a href="#linux" id="markdown-toc-linux">Linux</a><li><a href="#macos" id="markdown-toc-macos">macOS</a></ol><li><a href="#to-check-certificate-metadata" id="markdown-toc-to-check-certificate-metadata">To check certificate metadata</a></ol><li><a href="#ssh-certificate-extensions" id="markdown-toc-ssh-certificate-extensions">SSH certificate extensions</a></ol></details><hr /><h2 class="mb-5" id="ssh-authentication-methods"> <a href="#ssh-authentication-methods" class="anchor-heading" aria-labelledby="ssh-authentication-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SSH authentication methods</h2><p>There are two popular ways to SSH into a server.</p><ul><li>Use a system <strong>password</strong><li>Use <strong>SSH key</strong></ul><p>Using an SSH key adds more security layers compared to using a system password.</p><p>However, even with an SSH key, there still exists a problem that once an SSH key is placed on the <code class="language-plaintext highlighter-rouge">authorized_keys</code> of the server, it is permanent unless someone actively removes it.</p><p>This may not matter if you’re the one and only person trying to SSH into a server, but if the number of people that need to be given or revoked access increases, this can become a hassle.</p><p>Using SSH certificates can alleviate these issues.</p><hr /><h2 class="mb-5" id="ssh-certificates-1"> <a href="#ssh-certificates-1" class="anchor-heading" aria-labelledby="ssh-certificates-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SSH certificates</h2><p>SSH certificate authentication goes in both directions. The <strong>server/host</strong> presents its certificate to the <strong>user/client</strong>, and vice versa.</p><p>The whole idea of a certificate is simple:</p><ul><li>Both parties agree on some <strong>authority</strong> and trust what it signs.</ul><p>Such authority is called a <strong>Certificate Authority (CA)</strong>.</p><p class="note">Technically, our CA is just a pair of cryptographic keys.</p><p>So instead of trusting each user keys, parties will decide trust the CA that will sign those keys. This eliminates having to accumulate public keys in <code class="language-plaintext highlighter-rouge">authorized_keys</code>.</p><p>In addition, CAs can set a expiration date on their signatures.</p><p>So if you decide to give someone a server access for only a single day, but don’t want to bother remembering to come back after a day to remove his/her key from your <code class="language-plaintext highlighter-rouge">authorized_keys</code>, you can have the CA sign the key to only be valid for a day.</p><p>In the following example, I will be using <a href="../vault/index">Vault</a> to manage these CAs.</p><hr /><h2 class="mb-5" id="host-certificate"> <a href="#host-certificate" class="anchor-heading" aria-labelledby="host-certificate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Host certificate</h2><p>Usually people dismiss the need for host certificates. However it is a good security layer to prevent SSHing into a bad machine.</p><p>When you’re SSHing without a certificate, you’ve probably seen something like this.</p><div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>ssh server
<span class="go">The authenticity of host 'badsiteindisguise.com' can't be established.
...cryptographic key fingerprint...
Are you sure you want to continue connecting (yes/no/[fingerprint])?
</span></code></pre></div></div><p>Usually you just end up typing yes, which adds the fingerprint to <code class="language-plaintext highlighter-rouge">~/.ssh/known_hosts</code> and you never see the prompt again.</p><p>However, just like the prompt says, <code class="language-plaintext highlighter-rouge">are you sure</code> that this site can be trusted? Are you sure that there wasn’t a man in the middle that redirected you to one of his <em>bad</em> machines?</p><p>By placing a trusted host CA’s public key on the client before the first SSH, this security risk can be avoided.</p><h3 class="mb-4" id="configure-a-host-ca"> <a href="#configure-a-host-ca" class="anchor-heading" aria-labelledby="configure-a-host-ca"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure a host CA</h3><p>Create a key pair for host CA:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-C</span> <span class="s2">"hostca"</span> <span class="nt">-f</span> hostca
</code></pre></div></div><p>Which produces <code class="language-plaintext highlighter-rouge">hostca</code> and <code class="language-plaintext highlighter-rouge">hostca.pub</code>.</p><p class="note"><code class="language-plaintext highlighter-rouge">vault write ssh-host-signer/config/ca generate_signing_key=true</code> currently only generates <code class="language-plaintext highlighter-rouge">rsa</code> keys, which is deprecated in newer OpenSSH. To use different crypto algorithms such as <code class="language-plaintext highlighter-rouge">ed25519</code>, you have to generate one and upload it to Vault.</p><p class="mt-6">Mount the SSH secrets engine on Vault:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault secrets <span class="nb">enable</span> <span class="nt">-path</span><span class="o">=</span>ssh-host-signer ssh
</code></pre></div></div><p class="note">The <code class="language-plaintext highlighter-rouge">path</code> can be anything you like, just make sure you are logged in to Vault and has the policy to read/write to that path.</p><p class="mt-6">Upload the CA key pair:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault write ssh-host-signer/config/ca <span class="se">\</span>
  <span class="nv">private_key</span><span class="o">=</span>@hostca <span class="se">\</span>
  <span class="nv">public_key</span><span class="o">=</span>@hostca.pub
</code></pre></div></div><p class="note">The <code class="language-plaintext highlighter-rouge">@</code> points to the file. Use <code class="language-plaintext highlighter-rouge">"..."</code> to copy and paste the values.</p><p class="mt-6">Extend the host key certificate TTL (time-to-live):</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault secrets tune <span class="nt">-max-lease-ttl</span><span class="o">=</span>87600h ssh-host-signer
</code></pre></div></div><p class="note"><code class="language-plaintext highlighter-rouge">87600h</code> is 10 years.</p><p class="mt-6">Create a role to sign host keys:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault write ssh-host-signer/roles/hostrole <span class="se">\</span>
  <span class="nv">key_type</span><span class="o">=</span>ca <span class="se">\</span>
  <span class="nv">ttl</span><span class="o">=</span>87600h <span class="se">\</span>
  <span class="nv">allow_host_certificates</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nv">allowed_domains</span><span class="o">=</span><span class="s2">"example.com,something.com"</span> <span class="se">\</span>
  <span class="nv">allow_bare_domains</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nv">allow_subdomains</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div></div><p>Vault uses these roles to sign keys.</p><p>The above configuration basically says it can sign host certificates for domains of <code class="language-plaintext highlighter-rouge">example.com</code>, <code class="language-plaintext highlighter-rouge">*.example.com</code>, <code class="language-plaintext highlighter-rouge">something.com</code>, <code class="language-plaintext highlighter-rouge">*.something.com</code>, and the certificate will be valid for 10 years.</p><h3 class="mb-4" id="sign-the-host-key-with-ca"> <a href="#sign-the-host-key-with-ca" class="anchor-heading" aria-labelledby="sign-the-host-key-with-ca"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sign the host key with CA</h3><p>Sign and save the resulting certificate on the server:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault write <span class="nt">-field</span><span class="o">=</span>signed_key ssh-host-signer/sign/hostrole <span class="se">\</span>
  <span class="nv">cert_type</span><span class="o">=</span>host <span class="se">\</span>
  <span class="nv">public_key</span><span class="o">=</span>@/etc/ssh/ssh_host_ed25519_key.pub <span class="o">&gt;</span> /etc/ssh/ssh_host_ed25519_key-cert.pub
</code></pre></div></div><p class="mt-6">Optionally set permission on the certificate:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chmod </span>0640 /etc/ssh/ssh_host_ed25519_key-cert.pub
</code></pre></div></div><p class="note">If the host key doesn’t exist, create one using <code class="language-plaintext highlighter-rouge">ssh-keygen</code>.</p><p class="mt-6">Update <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code>:</p><div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HostKey</span> /etc/ssh/ssh_ed25519_key
<span class="k">HostCertificate</span> /etc/ssh/ssh_ed25519_key-cert.pub
</code></pre></div></div><h3 class="mb-4" id="save-host-ca-public-key-on-client"> <a href="#save-host-ca-public-key-on-client" class="anchor-heading" aria-labelledby="save-host-ca-public-key-on-client"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Save host CA public key on client</h3><p><strong>From the client</strong>, get the public key of <code class="language-plaintext highlighter-rouge">ssh-host-signer</code> CA:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If using API endpoint</span>
curl &lt;vault-api-url&gt;/v1/ssh-host-signer/public-key
</code></pre></div></div><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If client has direct access to the Vault server</span>
vault <span class="nb">read</span> <span class="nt">-field</span><span class="o">=</span>public_key ssh-host-signer/config/ca
</code></pre></div></div><p class="mt-6">Save the result to client’s <code class="language-plaintext highlighter-rouge">~/.ssh/known_hosts</code>:</p><div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">@</span>cert-authority *.example.com,*.something.com ssh-ed25519 ...
</code></pre></div></div><p class="note">If you have already logged in to the server before the host certificate was set up, <strong>remove</strong> the corresponding fingerprint in <code class="language-plaintext highlighter-rouge">known_hosts</code>.</p><p class="warn">Try SSHing to the server with a password or a regular public key. <br /> <br /> Assuming you have never SSHed to the server before or have removed the previous fingerprint, SSH <strong>should not</strong> show you the <code class="language-plaintext highlighter-rouge">Are you sure you want to continue</code> prompt. <br /> <br /> If it does, the host certificate is <strong>not</strong> set up correctly.</p><hr /><h2 class="mb-5" id="client-certificate"> <a href="#client-certificate" class="anchor-heading" aria-labelledby="client-certificate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Client certificate</h2><p>Instead of having the client’s public key saved to host’s <code class="language-plaintext highlighter-rouge">authorized_keys</code>, we will have the client use a certificate to authenticate.</p><p>Some of the process is actually very similar to <a href="#host-certificate">above</a>. Mostly the only difference is to use <code class="language-plaintext highlighter-rouge">client</code> or <code class="language-plaintext highlighter-rouge">user</code> instead of <code class="language-plaintext highlighter-rouge">host</code>.</p><h3 class="mb-4" id="configure-a-client-ca"> <a href="#configure-a-client-ca" class="anchor-heading" aria-labelledby="configure-a-client-ca"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure a client CA</h3><p>Create a key pair for client CA:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-C</span> <span class="s2">"clientca"</span> <span class="nt">-f</span> clientca
</code></pre></div></div><p>Which produces <code class="language-plaintext highlighter-rouge">clientca</code> and <code class="language-plaintext highlighter-rouge">clientca.pub</code>.</p><p class="note">You can actually use the same pair of keys you used for host CA.</p><p class="mt-6">Mount the SSH secrets engine on Vault:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault secrets <span class="nb">enable</span> <span class="nt">-path</span><span class="o">=</span>ssh-client-signer ssh
</code></pre></div></div><p class="mt-6">Upload the CA key pair:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault write ssh-client-signer/config/ca <span class="se">\</span>
  <span class="nv">private_key</span><span class="o">=</span>@clientca <span class="se">\</span>
  <span class="nv">public_key</span><span class="o">=</span>@clientca.pub
</code></pre></div></div><p class="mt-6">Create a role to sign client keys:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault write ssh-client-signer/roles/clientrole -<span class="o">&lt;&lt;</span><span class="sh">"</span><span class="no">EOH</span><span class="sh">"
{
  "allow_user_certificates": true,
  "allowed_users": "my-user",
  "allowed_extensions": "permit-pty,permit-port-forwarding,permit-x11-forwarding,permit-agent-forwarding,permit-user-rc",
  "default_extensions": [
    {
      "permit-pty": ""
    }
  ],
  "key_type": "ca",
  "default_user": "my-user",
  "ttl": "30m0s"
}
</span><span class="no">EOH
</span></code></pre></div></div><ul><li><code class="language-plaintext highlighter-rouge">allowed_users</code>: Comma separated list of allowed username<li><code class="language-plaintext highlighter-rouge">allowed_extensions</code>: Comma separated list of extensions that client can request in their certificate<li><code class="language-plaintext highlighter-rouge">default_extensions</code>: Default extensions given when this role signs a certificate<li><code class="language-plaintext highlighter-rouge">default_user</code>: Username to use when one isn’t specified<li><code class="language-plaintext highlighter-rouge">ttl</code>: Client certificate expires after <code class="language-plaintext highlighter-rouge">ttl</code>.</ul><h3 class="mb-4" id="sign-the-client-key-with-ca"> <a href="#sign-the-client-key-with-ca" class="anchor-heading" aria-labelledby="sign-the-client-key-with-ca"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sign the client key with CA</h3><p>Create an SSH key if one doesn’t already exist:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-C</span> <span class="s2">"user@example.com"</span> <span class="nt">-f</span> client_key
</code></pre></div></div><p class="mt-6">Sign and save the resulting certificate on the client:</p><ul><li>To accept default</ul><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault write <span class="nt">-field</span><span class="o">=</span>signed_key ssh-client-signer/sign/clientrole <span class="se">\</span>
  <span class="nv">public_key</span><span class="o">=</span>@client_key.pub <span class="o">&gt;</span> client_key-cert.pub
</code></pre></div></div><ul><li>To customize</ul><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vault write ssh-client-signer/sign/my-role -<span class="o">&lt;&lt;</span><span class="sh">"</span><span class="no">EOH</span><span class="sh">"
{
  "public_key": "ssh-ed25519 ...",
  "valid_principals": "my-user",
  "extensions": {
    "permit-pty": "",
    "permit-port-forwarding": ""
  }
}
</span><span class="no">EOH
</span></code></pre></div></div><p>Then copy and paste the certificate to <code class="language-plaintext highlighter-rouge">client_key-cert.pub</code>.</p><p class="note">If your certificate ends in the <code class="language-plaintext highlighter-rouge">&lt;same_base&gt;-cert.pub</code> suffix, OpenSSH will automatically detect it so you won’t have to pass in your certificate as an identity file in addition to the private key.</p><h3 class="mb-4" id="save-client-ca-public-key-on-host"> <a href="#save-client-ca-public-key-on-host" class="anchor-heading" aria-labelledby="save-client-ca-public-key-on-host"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Save client CA public key on host</h3><p><strong>From the host</strong>, get the public key of <code class="language-plaintext highlighter-rouge">ssh-client-signer</code> CA and save it to <code class="language-plaintext highlighter-rouge">/etc/ssh/trusted-user-ca-keys.pem</code>:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If using API endpoint</span>
curl <span class="nt">-o</span> /etc/ssh/trusted-user-ca-keys.pem http://127.0.0.1:8200/v1/ssh-client-signer/public_key
</code></pre></div></div><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If host has direct access to the Vault server</span>
vault <span class="nb">read</span> <span class="nt">-field</span><span class="o">=</span>public_key ssh-client-signer/config/ca <span class="o">&gt;</span> /etc/ssh/trusted-user-ca-keys.pem
</code></pre></div></div><p class="mt-6">Now modify <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code> on host:</p><div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /etc/ssh/sshd_config</span>
<span class="k">TrustedUserCAKeys</span> /etc/ssh/trusted-user-ca-keys.pem
</code></pre></div></div><hr /><h2 class="mb-5" id="host-sshd_config-settings"> <a href="#host-sshd_config-settings" class="anchor-heading" aria-labelledby="host-sshd_config-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Host <code class="language-plaintext highlighter-rouge">sshd_config</code> settings</h2><p>To disable SSH password authentication,</p><div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /etc/ssh/sshd_config</span>
<span class="k">PasswordAuthentication</span> <span class="no">no</span>
<span class="k">ChallengeResponseAuthentication</span> <span class="no">no</span>
</code></pre></div></div><p>Recap:</p><div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HostKey</span> /etc/ssh/ssh_ed25519_key
<span class="k">HostCertificate</span> /etc/ssh/ssh_ed25519_key-cert.pub
</code></pre></div></div><div class="language-ssh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /etc/ssh/sshd_config</span>
<span class="k">TrustedUserCAKeys</span> /etc/ssh/trusted-user-ca-keys.pem
</code></pre></div></div><hr /><h2 class="mb-5" id="test-connection"> <a href="#test-connection" class="anchor-heading" aria-labelledby="test-connection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test connection</h2><p>Now the client should be able to authenticate to the server with certificates:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If the certificate ends in '-cert.pub' with the same base name</span>
ssh <span class="nt">-i</span> ~/.ssh/client_key my-user@example.com
</code></pre></div></div><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If the certificate has a different naming scheme</span>
ssh <span class="nt">-i</span> ~/.ssh/client-certificate.pub <span class="nt">-i</span> ~/.ssh/client_key my-user@example.com
</code></pre></div></div><p>Connection is a success if you don’t see any fingerprint validation prompt and was able to connect without adding <code class="language-plaintext highlighter-rouge">client_key.pub</code> to host’s <code class="language-plaintext highlighter-rouge">authorized_keys</code>.</p><hr /><h2 id="debugging"> <a href="#debugging" class="anchor-heading" aria-labelledby="debugging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging</h2><h3 class="mb-4" id="from-the-client-side"> <a href="#from-the-client-side" class="anchor-heading" aria-labelledby="from-the-client-side"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> From the client side</h3><p>Add <strong><code class="language-plaintext highlighter-rouge">-vvv</code></strong> to get a verbose log output:</p><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-vvv</span> <span class="nt">-i</span> ~/.ssh/client_key my-user@example.com
</code></pre></div></div><h3 class="mb-4" id="from-the-host-side"> <a href="#from-the-host-side" class="anchor-heading" aria-labelledby="from-the-host-side"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> From the host side</h3><h4 class="mb-3" id="linux"> <a href="#linux" class="anchor-heading" aria-labelledby="linux"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Linux</h4><p>Set the <code class="language-plaintext highlighter-rouge">LogLevel</code> in <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code> to <code class="language-plaintext highlighter-rouge">VERBOSE</code>.</p><p>Then inspect <code class="language-plaintext highlighter-rouge">/var/log/auth.log</code>.</p><h4 class="mt-6 mb-3" id="macos"> <a href="#macos" class="anchor-heading" aria-labelledby="macos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> macOS</h4><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log show <span class="nt">--process</span> sshd <span class="nt">--last</span> &lt;num&gt; <span class="nt">--debug</span> <span class="nt">--info</span>
</code></pre></div></div><p class="note">See <code class="language-plaintext highlighter-rouge">log show help</code> for details.</p><h3 class="mb-4" id="to-check-certificate-metadata"> <a href="#to-check-certificate-metadata" class="anchor-heading" aria-labelledby="to-check-certificate-metadata"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> To check certificate metadata</h3><div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-Lf</span> ssh_key-cert.pub
</code></pre></div></div><hr /><h2 class="mb-5" id="ssh-certificate-extensions"> <a href="#ssh-certificate-extensions" class="anchor-heading" aria-labelledby="ssh-certificate-extensions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SSH certificate extensions</h2><p>Some of the basic extensions (names are self explanatory):</p><ul><li><code class="language-plaintext highlighter-rouge">permit-pty</code>: Allow interactive shell<li><code class="language-plaintext highlighter-rouge">permit-port-forwarding</code>: Allow SSH tunnels<li><code class="language-plaintext highlighter-rouge">permit-x11-forwarding</code><li><code class="language-plaintext highlighter-rouge">permit-agent-forwarding</code><li><code class="language-plaintext highlighter-rouge">permit-user-rc</code></ul><hr /><p>References:</p><ul><li><a href="https://www.vaultproject.io/docs/secrets/ssh/signed-ssh-certificates">Vault: Signed SSH Certificates</a></ul></main><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Itty Bitty</p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div>
